{"version":3,"file":"Form-bda09d41.js","sources":["../../../../components/common/widgets/registry.ts","../../../../components/common/Form.vue","../../../../components/containers/Form.vue"],"sourcesContent":["import PrezMembers from './prez:members.vue'\n\nexport default {\n    'prez:members': PrezMembers\n}\n","<script setup lang=\"ts\">\nimport type { Form, HeaderLink } from '~/lib/prez.d';\nimport { template } from '~/helpers/str';\nimport registry from './widgets/registry';\n\nconst props = defineProps<{form: Form, formTitle?:string, headerTitle?:string, excludeFields?: string[], fields?: string[], info?: boolean, links?: HeaderLink[]}>();\nconst excludeFields = props.excludeFields ? props.excludeFields : [/^prez:./];\n\nconst customWidgets:Record<string, boolean>= {};\nconst fields = (props.fields ? props.fields : Object.keys(props.form.formHeaders))\n  .filter(field=>{\n    // check the field to output is available\n    if(!(field in props.form.formHeaders) || !(field in props.form.fields)) {\n      console.warn(`${field} not found in form\\n(${Object.keys(props.form.formHeaders)})`)\n      return false;\n    }\n    // if this field is in the registry, then only exclude if we have an exact match\n    if(field in registry) {\n      if((excludeFields as string[]).indexOf(field) >= 0) {\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      // check it doesn't match one of the exclude fields\n      for(const idx in excludeFields) {\n        if(field.match(excludeFields[idx])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  });\n\nconst isSubForm = (field:string) => {\n  return Array.isArray(props.form.fields[field]) && typeof(props.form.fields[field][0]) == 'object'\n}\n\nconst isStringArray = (field:string) => {\n  return Array.isArray(props.form.fields[field]) && typeof(props.form.fields[field][0]) == 'string'\n}\n\nconst route = useRouter();\n\n</script>\n<template>\n  <div class=\"form\" style=\"position:relative\" v-if=\"form && form.count > 0\">\n    <div v-if=\"headerTitle && form\" class=\"text-h3 mb-5 mt-2\">{{ template(headerTitle, form) }}</div>\n    <v-chip v-if=\"form.header.label\" variant=\"flat\" style=\"position: absolute; right: 0;top:0;\">{{ form.header.label }}</v-chip>\n    <v-table theme=\"dark\" v-if=\"form\">\n      <thead v-if=\"formTitle\">\n        <tr><th colspan=\"2\">{{ template(formTitle, form) }}</th></tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"field in fields\">\n          <th style=\"white-space: nowrap;\">\n            {{ form.formHeaders[field].label }}\n            &nbsp;<a :href=\"form.formHeaders[field].iri\" :title=\"field\"><v-icon icon=\"mdi-link\"></v-icon></a>\n            <div v-if=\"info\">{{ field }}</div>\n          </th>\n          <td v-if=\"!(field in registry)\" :class=\"isSubForm(field) ? 'td-nest' : undefined\">\n            <v-chip size=\"x-small\" v-if=\"form.fields._meta?.[field]?.type\">{{ form.fields._meta[field].type }}</v-chip>\n\n            <div :title=\"field in form.fields._meta! && form.fields[field] != form.fields._meta![field].value ? form.fields._meta![field].value : null\" >\n              <nuxt-link v-if=\"field == 'prez:link'\" :to=\"form.fields[field]\">{{ form.fields[field] }}</nuxt-link>\n              {{ (typeof(form.fields[field]) != 'object' && field != 'prez:link' ? form.fields[field] : '') }}\n              {{isStringArray(field) ? form.fields[field].join(', ') : '' }}\n              <CommonForm\n                v-for=\"f in form.fields[field]\" \n                v-if=\"isSubForm(field)\"\n                :form=\"f\"\n                :exclude-fields=\"excludeFields\"\n              />\n            </div>\n          </td>\n          <td v-else>\n            <CommonWidgets v-if=\"field in registry\" :form=\"form\" :info=\"form.fields[field]\" :field-name=\"field as keyof typeof registry\" />\n          </td>\n        </tr>\n      </tbody>\n    </v-table>\n    <v-chip-group v-if=\"links\">\n      <v-chip v-for=\"link in links.filter(link=>link.title)\">\n        {{ link.title }}\n      </v-chip>\n    </v-chip-group>\n  </div>\n</template>\n\n<style scoped>\n.td-max {\n  overflow: hidden;\n   text-overflow: ellipsis;\n   display: -webkit-box;\n   -webkit-line-clamp: 2; /* number of lines to show */\n           line-clamp: 2;\n           text-overflow: ellipsis; \n   -webkit-box-orient: vertical;\n}\n/* tbody tr:hover, tbody tr:hover table:hover * {\n  background-color: #555 !important;\n} */\nth {\n  width: 1%;\n}\ntd {\n  width: 100%;\n}\ntd a {\n  color:#333;\n}\ntd.td-nest {\n  padding-right:0 !important;\n}\n\ntable .td-nest table td, table .td-nest table th  {\n  background-color: #eee;\n}\n\ntable .td-nest .v-table {\n  border-left:3px solid #ccc;\n}\n\ntd .v-chip {\n  float:right;\n}\n.v-table thead {\n  background-color: #19198c;\n}\n.v-table thead th {\n  color:white !important;\n}\n.v-table tbody {\n  background-color: #eee;\n  color:#333;\n}\n.v-table tbody tr td, .v-table tbody tr th {\n  border-right:1px solid #bbb;\n  border-bottom:1px solid #bbb !important;\n}\n.v-table tbody tr td:last-child {\n  border-right:0;\n}\n.v-table tbody tr:last-child td, .v-table tbody tr:last-child th {\n  border-bottom:0 !important;\n}\n.v-table tbody tr:hover td, .v-table tbody tr:hover th {\n  background-color: #ddd !important;\n}\n\ntd.td-nest div.form .v-table {\n  margin-bottom:5px;\n  border-bottom:2px solid #ddd;\n}\ntd.td-nest div.form .v-table {\n  margin-top:5px;\n  border-top:1px solid #ddd;\n}\n\n</style>","<script setup lang=\"ts\">\nimport { useRDFStore } from \"@/stores/rdf\";\nimport type { Form } from '~/lib/prez.d';\nimport { storeToRefs } from \"pinia\";\nimport type { Prez } from \"~/lib/prez\";\nimport { emit } from \"process\";\n\nconst props = defineProps<{dataUrl:string, formTitle?:string, excludeFields?: string[], headerTitle?:string, fields?:string[], info?:boolean}>();\n\nconst rdfStore = useRDFStore();\nconst { loading, success, error, prez } = storeToRefs(rdfStore)\n\nconst page = ref(1);\nconst form = ref<Form|undefined>(undefined);\nconst parseError = ref<string|null>(null);\n\nonMounted(async ()=> {\n  await initData();\n})\n\nconst route = useRoute();\nconst query = ref(route.query);\nwatch(()=> query.value = route.query, ()=>{});\n\nasync function initData() {\n  await rdfStore.load(props.dataUrl, { params: { page: page.value } });\n\n  if(success.value) {\n    try {\n      parseError.value = null;\n      form.value = prez.value!.form(\n        ['skos:prefLabel', 'dcterms:title', 'rdfs:label', 'schema:name'],\n        ['skos:definition', 'dcterms:description', 'schema:description']\n      );\n        //['skos:prefLabel', 'rdfs:label']);\n    } catch(ex) {\n      parseError.value = (ex as Error).message;\n    }\n  }\n\n  //emitPrezUpdate(prez.value);\n}\n\n// Emit an event with the updated title\nfunction emitPrezUpdate(newPrez:Prez) {\n  // Example event name: 'updateBreadcrumbTitle'\n  // Emit the event with the new title information\n  //emit('updatePrez', newPrez);\n}\n\n</script>\n\n<template>\n  <CommonForm v-if=\"form\" \n    :header-title=\"headerTitle\"\n    :form-title=\"formTitle\" \n    :form=\"form\"\n    :fields=\"fields\"\n    :exclude-fields=\"excludeFields\"\n    :info=\"info\"\n    :links=\"prez!.headerLinks\"\n  />\n  <CommonLoading :loading=\"loading\" :error=\"error\" />\n  <!-- <div>\n    <nuxt-link to=\"?page=2\">Page 2</nuxt-link>\n  </div>\n  <div>PAGE = {{ query.page }}</div>\n  <div>\n\n    <div>\n      <div>URL = {{ listUrl }}</div>\n      <div>Loading = {{ loading }}</div>\n      <div>Error = {{ error }}</div>\n      <div>Success = {{ success }}</div>\n    </div>\n\n  </div> -->\n</template>"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAe,WAAA;AAAA,EACX,gBAAgB;AACpB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACCA,UAAM,QAAQ;AACd,UAAM,gBAAgB,MAAM,gBAAgB,MAAM,gBAAgB,CAAC,SAAS;AAG5E,UAAM,UAAU,MAAM,SAAS,MAAM,SAAS,OAAO,KAAK,MAAM,KAAK,WAAW,GAC7E,OAAO,CAAO,UAAA;AAEV,UAAA,EAAE,SAAS,MAAM,KAAK,gBAAgB,EAAE,SAAS,MAAM,KAAK,SAAS;AAC9D,gBAAA,KAAK,GAAG,KAAK;AAAA,GAAwB,OAAO,KAAK,MAAM,KAAK,WAAW,CAAC,GAAG;AAC5E,eAAA;AAAA,MACT;AAEA,UAAG,SAAS,UAAU;AACpB,YAAI,cAA2B,QAAQ,KAAK,KAAK,GAAG;AAC3C,iBAAA;AAAA,QAAA,OACF;AACE,iBAAA;AAAA,QACT;AAAA,MAAA,OACK;AAEL,mBAAU,OAAO,eAAe;AAC9B,cAAG,MAAM,MAAM,cAAc,GAAG,CAAC,GAAG;AAC3B,mBAAA;AAAA,UACT;AAAA,QACF;AACO,eAAA;AAAA,MACT;AAAA,IAAA,CACD;AAEG,UAAA,YAAY,CAAC,UAAiB;AAClC,aAAO,MAAM,QAAQ,MAAM,KAAK,OAAO,KAAK,CAAC,KAAK,OAAO,MAAM,KAAK,OAAO,KAAK,EAAE,CAAC,KAAM;AAAA,IAAA;AAGrF,UAAA,gBAAgB,CAAC,UAAiB;AACtC,aAAO,MAAM,QAAQ,MAAM,KAAK,OAAO,KAAK,CAAC,KAAK,OAAO,MAAM,KAAK,OAAO,KAAK,EAAE,CAAC,KAAM;AAAA,IAAA;AAG7E,cAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjCxB,UAAM,WAAW;AACjB,UAAM,EAAE,SAAS,SAAS,OAAO,SAAS,YAAY,QAAQ;AAEjD,QAAI,CAAC;AACZ,UAAA,OAAO,IAAoB,MAAS;AACvB,QAAiB,IAAI;AAMxC,UAAM,QAAQ;AACR,UAAA,QAAQ,IAAI,MAAM,KAAK;AAC7B,UAAM,MAAK,MAAM,QAAQ,MAAM,OAAO,MAAI;AAAA,IAAA,CAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}