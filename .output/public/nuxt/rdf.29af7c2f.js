var x=Object.defineProperty;var S=(u,t,e)=>t in u?x(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var f=(u,t,e)=>(S(u,typeof t!="symbol"?t+"":t,e),e);import{B as Q}from"./entry.b71f7d2c.js";import{D as A,N as w,a as k,b as H,B as E}from"./axios.7bde71be.js";import{p as D,g as j}from"./str.0b61149f.js";const{namedNode:y}=A,b=y("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),v=y("http://www.w3.org/2000/01/rdf-schema#label");class z{constructor(){f(this,"store");f(this,"data");f(this,"parser");f(this,"prefixes");f(this,"headerLinks");this.store=new w,this.parser=new k,this.data=[],this.prefixes={},this.headerLinks=[]}async fetch(t,e){try{const s=await H(t,e);if(s.status!=200)throw new Error(`Request failed with status ${s.status}`);this.headerLinks=D(s.headers.link),await this.load(await s.data)}catch(s){throw s instanceof Error?new Error(`Error: ${s.message}`):new Error("An unknown error occurred.")}}async load(t){await this.parser.parse(t,(e,s,r)=>{r&&(this.prefixes=r),s&&this.data.push(s)}),this.store=new w(this.data)}expandAll(t){return t.map(e=>this.expand(e))}expand(t){const e=t.split(":");return e.length>=2&&e[0]in this.prefixes?(e[0]=this.prefixes[e[0]].toString(),e[0]+e.slice(1).join(":")):t}firstQuad(t,e,s,r){const i=this.store.getQuads(t,e,s,r);return i&&i.length>0?i[0]:null}list(t=[],e=[]){let s="",r=[],i=0;const o=this.firstQuad(null,this.expand("prez:count"),null,null);if(o!==null){i=parseInt(o.object.value),s=o.subject.value;const p=b;r=this.store.getSubjects(p,s,null)}else throw new Error("prez:count predicate not found");const a=this.store.getQuads(s,v,null,null),c=this.compact(s),l={listHeaders:{},header:{label:a.length>0?a[0].object.value:c,iri:s,link:s},count:i,list:[],iri:c},d=this.expandAll(t),n=this.expandAll(e);for(const p in r){const m=r[p].value,g=this.getSubjectData(m,d,n);Object.keys(g).filter(h=>h!="_meta").forEach(h=>{h in l.listHeaders||(l.listHeaders[h]=this.getHeader(this.expand(h),g[h]))}),l.list.push(g)}return l}form(t=[],e=[],s){console.log("FORM");let r=0,i=s||"",o="";if(i==""){const n=this.firstQuad(null,b,null,null);if(n!==null)i=n.subject.value,o=n.object.value;else throw new Error("rdf:type predicate not found")}const a={formHeaders:{},header:{label:this.compact(o),iri:i,link:i},count:r,fields:{},iri:this.compact(i)},c=this.expandAll(t),l=this.expandAll(e),d=this.getSubjectData(i,c,l);return Object.keys(d).filter(n=>n!="_meta").forEach(n=>{n in a.formHeaders||(i[0]!="_"||n!="iri")&&(a.formHeaders[n]=this.getHeader(this.expand(n),d[n]))}),a.count=Object.keys(a.formHeaders).length,a.fields=d,a}getSubjectData(t,e,s){const r={iri:t,_meta:{}},i=this.store.getQuads(t,null,null,null);for(const o in i){const a=i[o],c=this.compact(a.predicate.value),l=this.getMeta(a,e,s);if(console.log(o," = "+a.object.value),console.log("XX"),a.object instanceof E)c in r||(r[c]=[]),r[c].push(this.form(e,s,"_:"+a.object.value));else{const d=this.store.getQuads(t,a.predicate.value,null,null);let n;d.map(p=>{const{label:m,description:g}=this.getAnnotations(p.object.value,e,s),h=m!==void 0?m:p.object.value;n!==void 0?(Array.isArray(n)||(n=[n]),n.push(h)):n=h}),l.value=n===void 0?a.predicate.value:n,r[c]=l.value}r._meta[c]=l}return r}getMeta(t,e,s){const{label:r,description:i}=this.getAnnotations(t.predicate.value,e,s);let o,a;if(t.object.datatype){console.log("DATA TYPE = ",t.object),a=t.object.datatype.value;const l=this.firstQuad(a,v,null,null);o=j(l!==null&&l.object.value?l.object.value.toString():a)}return{iri:t.predicate.value,label:r,description:i,typeIRI:a,type:o}}getHeader(t,e){const s=this.firstQuad(t,v,null,null),r={iri:t,link:v.value,label:j(s!==null&&s.object.value?s.object.value:t),description:""};return console.log("HEAD=",r,"ITEM=",e),r}getAnnotations(t,e,s){let r,i;return e.map(o=>{if(r===void 0){const a=this.firstQuad(t,o,null,null);a&&(r=a.object.value)}}),s.map(o=>{if(i===void 0){const a=this.firstQuad(t,o,null,null);a&&(i=a.object.value)}}),{label:r,description:i}}compact(t){for(const e in this.prefixes)if(t.startsWith(this.prefixes[e].toString()))return`${e}:${t.substring(this.prefixes[e].toString().length)}`;return t==b.value?"rdf:type":t}}const L=Q("rdf",{state:()=>({cache:{},loading:!1,error:"",success:!1,prez:null}),actions:{clearCache(){this.cache={}},async load(u,t){try{this.loading=!0,this.success=!1;const e=u+JSON.stringify(t);e in this.cache?this.prez=this.cache[e]:(this.prez=new z,await this.prez.fetch(u,t),this.cache[e]=this.prez),this.success=!0,this.error=null}catch(e){this.error=e.message,this.success=!1}finally{this.loading=!1}}}});export{L as u};
